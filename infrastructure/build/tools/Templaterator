#!/usr/bin/env python3
##############################################################################
# (c) Crown copyright 2024 Met Office. All rights reserved.
# The file LICENCE, distributed with this code, contains details of the terms
# under which the code may be used.
##############################################################################
# pylint: disable=invalid-name
"""
Command-line interface to templating functionality.
"""
from argparse import ArgumentParser, Namespace
from pathlib import Path

from templaterator.cli import parse_kv
from templaterator.engine import main


def parse_arguments() -> Namespace:
    """Function for parsing the input arguments of the script"""
    parser = ArgumentParser(
        description="Perform template substitution in Fortran files")
    parser.add_argument(
        "TEMPLATE_SOURCE", action="store", type=Path,
        help="The template source file to which the substitutions are to be "
             "performed"
    )
    parser.add_argument(
        "-o",
        "--output",
        action='store',
        type=str,
        help="Pattern for output file name, include 'key' from substitutions"
             "to be replaced by value."
    )
    parser.add_argument(
        "-s",
        "--substitutions",
        metavar="KEY=VALUE",
        action='append',
        help="Set a number of key-value pairs for substitutions"
             "If a space is to appear anywhere in the key or value"
             "then the whole string should be quoted:"
             '"some key = this is a sentence."'
             "Note that values are always treated as strings.")
    args = parser.parse_args()
    return args


if __name__ == "__main__":
    arguments = parse_arguments()
    kv_dicts = parse_kv(arguments.substitutions)
    main(arguments.TEMPLATE_SOURCE, kv_dicts, arguments.output)
