{%- set row    = "'row'" %}
{%- set column = "'column'" %}
{%- set auto   = "'auto'" %}
{%- set custom = "'custom'" %}

{%- set projectName = 'jedi_lfric_tests' %}
{%- set projectDir  = 'jedi_lfric_tests' %}
{%- set miniappFlag = True %}

{%- set projectApps = ['jedi_lfric_tests', 'jedi_forecast',
                       'jedi_forecast_pseudo', 'jedi_tlm_forecast_tl'] %}

{# Default setting to enable xios for all tasks in this suite. Is overrided if #}
{# 'use_xios' ["True"|"False"] is specified in the specific task directives    #}
{%- set default_use_xios = "True" %}

{# Default number of mpi ranks to be used by the xios server if unspecified    #}
{# directly in suite.rc task. Although it is set, it should only have any      #}
{# impact if xios is being used, i.e. if xios_nodes > 0. These aren't the most #}
{# intuitive variable names as they're using the existing naming convention    #}
{# They should be changed at a later date to be something more intuitive.      #}
{%- set default_mpi_parts_xios = 0 %}

{# Set the compiler debug profile for runs in this suite #}
{# Options are ['fast-debug'|'full-debug'|'production'], #}
{# omission defaults to 'fast-debug'                     #}
{%- set run_application_profile = '' %}

{%- set appDiagStemName = 'diagJedi_LFRic_Tests' %}
{%- set rdef_default    = "64" %}
{%- set mesh_rdef       = "64" %}
{%- set mesh_build      = "fast-debug" %}

{#========================================================================#}
{# MPI partitions & Panel decomposition                                   #}
{#========================================================================#}
{# Directive configuration for your task can be controlled                #}
{# using a dictionary, recognised entries are as follows                  #}
{#                                                                        #}
{# "mpi_parts" : Total number of process ranks for the task. Replaces     #}
{#               $TOTAL_RANKS environment variable in the app             #}
{# "panel_decomp" : Decompositon of partitions PER PANEL,                 #}
{#                  options are [auto|row|column|custom]                  #}
{# "xproc", "yproc" : Number of process ranks in x,y directions,          #}
{#                    only in effect if "panel_decomp":auto               #}
{# "use_xios" : Flag to enable/disable xios, [True|False]                 #}
{#              default is True                                           #}
{# "xios_nodes" : Number of extra nodes to reserve for the xios server    #}
{#                xios is used for IO (enabled if >0),                    #}
{# "mpi_parts_xios": Number of mpi ranks to be used by an xios            #}
{#                   server. If >0 xios is used in server mode.           #}
{#                   Has no effect if xios_nodes <1                       #}
{#                                                                        #}
{# NOTE: To enable xios server mode, valid entries are required for       #}
{#       "use_xios", "xios_nodes" and "mpi_parts_xios"                    #}
{#                                                                        #}
{# Example:  run task entry                                               #}
{#  'run_application(                                                     #}
{#        "gungho", "default", resolutions=[("BiP75x4-4000x2000",10.0)],  #}
{#        env={"nrun":10,                                                 #}
{#             "directives":{"default":{"mpi_parts":3,                    #}
{#                                      "panel_decomp":' + column + ',    #}
{#                                      "xproc":1,                        #}
{#                                      "yproc":3,                        #}
{#                                      "use_xios":"True",                #}
{#                                      "xios_nodes":1,                   #}
{#                                      "mpi_parts_xios":1} } } )'        #}
{#========================================================================#}


{%- set application_configurations = { 'jedi_lfric_tests' : ['nwp_gal9', 'runge-kutta'],
                                       'jedi_forecast' : ['default', 'no_xios'],
                                       'jedi_forecast_pseudo' : ['default', 'pseudomodel'],
                                       'jedi_tlm_forecast_tl' : ['default']} %}

{%- set canned_configurations = [] %}

{%- set groups = {
'developer': [
    'validate_rose_meta_graph("jedi_lfric_tests",appName="jedi_lfric_tests")',
    'check_config_dump_graph()',
    'check_style_graph()',
    'api_documentation_graph(publish=True)',
    'run_application("jedi_lfric_tests", "nwp_gal9",
                        resolutions=[("C12",1800.0)], env={"nrun":12,
                                                           "directives":{"C12":{"mpi_parts":6,
                                                                                "wallclock":"00:10:00"} } })',
    
    'run_application("jedi_lfric_tests", "runge-kutta",
                        resolutions=[("C12",1.0)], env={"nrun":20})',
    'check_compilers("jedi_lfric_tests", "runge-kutta", "all", "fast-debug",
                        resolution=("C12",1.0), publish=True )',
    'check_compilers("jedi_lfric_tests", "runge-kutta", "gnu", "full-debug",
                        resolution=("C12",1.0), publish=True )',
    'validate_rose_meta_graph("jedi_forecast",appName="jedi_forecast")',
    'run_application("jedi_forecast", "default", resolutions=[("C12",)],
                        env={"nrun":7})',
    'run_application("jedi_forecast", "no_xios", resolutions=[("C12",)],
                        env={"nrun":7,
                             "directives":{"default":{"use_xios":"False"} } } )',
    'validate_rose_meta_graph("jedi_forecast_pseudo",appName="jedi_forecast_pseudo")',
    'run_application("jedi_forecast_pseudo", "default", resolutions=[("C12",)],
                        env={"nrun":7})',
    'run_application("jedi_forecast_pseudo", "pseudomodel", resolutions=[("C12",)],
                        env={"nrun":7})',
    'validate_rose_meta_graph("jedi_tlm_forecast_tl",appName="jedi_tlm_forecast_tl")',
    'run_application("jedi_tlm_forecast_tl", "default", resolutions=[("C12",)],
                        env={"nrun":13})',
    'check_compilers("jedi_forecast", "default", "all", "fast-debug",
                        resolution=("C12",), publish=True )',
    'check_compilers("jedi_forecast", "default", "gnu", "full-debug",
                        resolution=("C12",), publish=True )',
    'check_compilers("jedi_forecast_pseudo", "pseudomodel", "all", "fast-debug",
                        resolution=("C12",), publish=True )',
    'check_compilers("jedi_forecast_pseudo", "pseudomodel", "gnu", "full-debug",
                        resolution=("C12",), publish=True )',
    'check_compilers("jedi_tlm_forecast_tl", "default", "all", "fast-debug",
                        resolution=("C12",), publish=True )',
    'check_compilers("jedi_tlm_forecast_tl", "default", "all", "full-debug",
                        resolution=("C12",), publish=True )'
  ],
  'nightly': [
    'publish_commit'
    ]
} %}
    
#########################################################################################

{# Include any local miniapp include files here #}
%include inc/suite_macros.rc
